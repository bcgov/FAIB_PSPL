library(sf)
library(terra)
# read gdb file
src <- 'D:/data/data_projects/AR2022/vri/VEG_COMP_LYR_R1_POLY_2021.gdb'
dest <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method1.tif')
src
dest
gdal_utils("rasterize",src,dest,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32 ',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '-99',
'-co','COMPRESS=LZW'),
'-overwrite')
src
dest
spatial_table
src <- "PG:'dbname=msyt' 'user=postgres'"
src
spatial_table <- 'veg_comp_spatial'
dest <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method1.tif')
spatial_table
dest
dest <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method2.tif')
gdal_utils("rasterize",src,dest,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32 ',
'-l', spatial_table,
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '-99',
'-co','COMPRESS=LZW'),
'-overwrite')
src <- "PG:dbname='msyt' user='postgres'"
gdal_utils("rasterize",src,dest,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32 ',
'-l', spatial_table,
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '-99',
'-co','COMPRESS=LZW'),
'-overwrite')
spatial_table <- 'msyt_2022.veg_comp_spatial'
gdal_utils("rasterize",src,dest,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32 ',
'-l', spatial_table,
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '-99',
'-co','COMPRESS=LZW'),
'-overwrite')
src <- 'D:/data/data_projects/AR2022/vri/VEG_COMP_LYR_R1_POLY_2021.gdb'
dest <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method3.tif')
cmd <- paste0(c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32 ',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '-99',
'-co','COMPRESS=LZW',src,dest))
gdal_rasterize <- 'C:/Program Files/GDAL/gdal_rasterize.exe'
system2(gdal_rasterize,args=cmd,wait=TRUE,stderr = TRUE)
tif_method1 <- paste0(getwd(),'/method1.tif')
tif_method2 <- paste0(getwd(),'/method2.tif')
tif_method3 <- paste0(getwd(),'/method3.tif')
r1 <- terra::rast(tif_method1)
tif_method1 <- 'D:/data/data_projects/VRI_Rasterization/method1.tif'
tif_method2 <- 'D:/data/data_projects/VRI_Rasterization/method2.tif'
tif_method3 <- 'D:/data/data_projects/VRI_Rasterization/method3.tif'
tif_method4 <- 'D:/data/data_projects/VRI_Rasterization/tif_fasterize.tif'
r1 <- terra::rast(tif_method1)
r3 <- terra::rast(tif_method3)
c1 <- r1 - r3
c1[c1 != 0] <- 1
f1 <- terra::freq(c1)
f1
r2 <- terra::rast(tif_method2)
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- terra::freq(c1)
f1
z <- r1[r1==-99]
terra::freq(z)
class(z)
z
nrow(z)
length(z)
length(r1)
nrow(r1)
tif_method4 <- 'D:/data/data_projects/VRI_Rasterization/tif_fasterize.tif'
r4 <- terra::rast(tif_method4)
terra::srs(r4)
terra::crs(r4)
terra::crs(r4) <- 'epsg:3005'
terra::crs(r4)
r4 <- terra::rast(tif_method4)
terra:crs(r4) <- 'epsg:3005'
terra::crs(r4) <- 'epsg:3005'
c1 <- r1 - r4
c1[c1 != 0] <- 1
f4 <- terra::freq(c1)
f4
r4[r4 == 0] <- NA
c1 <- r1 - r4
c1[c1 != 0] <- 1
f4 <- terra::freq(c1)
f4
r4 <- terra::rast(tif_method4)
# force projection
terra::crs(r4) <- 'epsg:3005'
# need to change existing 0 to NA to match r1 and r2
r4[r4 == 0] <- NA
# land / water mask supplied by Mike F.
f4 <- paste0(substr(getwd(),1,1),':/data/data_projects/base_data/land_water.tif')
mask_raster <- rast(f4)
# this mask is a 0/1 of land water
# there are values of 0 between Vancouver Island and the mainland.
# these need to be set to NA to be used as a land mask
# set values in mask to NA where 0
mask_raster[mask_raster==0] <- NA
crs(mask_raster ) <- 'epsg:3005'
r1[is.na(r1)] <- 0
r1_masked <- mask(r1,mask_raster)
r1_masked[r1_masked==0] <- NA
r4[is.na(r4)] <- 0
# apply the land mask
# filter out the water
r4_masked <- mask(r4,mask_raster)
# filter out any zeros
# set to NA
r4_masked[r4_masked==0] <- NA
c1 <- r1_masked - r4_masked
c1[c1 != 0] <- 1
f4 <- terra::freq(c1)
f4
