'-ot', 'UInt32 ',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW',src,dest))
gdal_rasterize <- 'C:/Program Files/GDAL/gdal_rasterize.exe'
system2(gdal_rasterize,args=cmd,wait=TRUE,stderr = TRUE)
gdal_utils("rasterize",src,dest,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW'),
'-overwrite')
# raster files
tif1 <- 'D:/data/data_projects/VRI_Rasterization/method1.tif'
tif2 <- 'D:/data/data_projects/AR2022/base/veg_comp_lyr_r1_poly_internal_2021.tif'
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(tif1)
r2 <- terra::rast(tif2)
ext1 <- terra::ext(r1)
ext2 <- terra::ext(r2)
ext1
ext2
# need to crop when extents are different
r1 <- terra::crop(r1,r2)
ext1 <- terra::ext(r1)
ext1
ext2
r1
r2
typeof(values(r1))
library(kableExtra)
# raster files
tif1 <- 'D:/data/data_projects/VRI_Rasterization/method1.tif'
tif2 <- 'D:/data/data_projects/AR2022/base/veg_comp_lyr_r1_poly_internal_2021.tif'
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(tif1)
r2 <- terra::rast(tif2)
ext1 <- terra::ext(r1)
ext2 <- terra::ext(r2)
ext1
ext2
# need to crop when extents are different
r1 <- terra::crop(r1,r2)
ext1 <- terra::ext(r1)
ext1
ext2
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- as.data.frame(terra::freq(c1))
f1 <- f1[,2:3]
kable(f1,format="html",caption = 'sf::gdal_utils.rasterize GDB to PostgreSQL') %>%
kable_styling(bootstrap_options = c("striped"),full_width=F,font_size=13,position = 'left')
n <- f1$count[f1$value==1]
v1 <- typeof(values(r1))
typeof(terra::values(r1))
terra::values(r2))
typeof(terra::values(r2))
v <- terra:;values(r1)
v <- terra:;values(r1)
v <- terra::values(r1)
typeon(v)
typeof(v)
terra:typeof(v)
terra::typeof(v)
typeof(v)
r2 <- terra::rast(tif2)
v2 <- typeof(terra::values(r2))
v2
v1 <- typeof(terra::values(r1,dataframe=TRUE))
v1
x <- as.data.frame(r1)
x
class(x)
head(x)
class(x$method1)
# raster files
tif1 <- 'D:/data/data_projects/VRI_Rasterization/method_int.tif'
tif2 <- 'D:/data/data_projects/VRI_Rasterization/method_float.tif'
# raster files
tif1 <- 'D:/data/data_projects/VRI_Rasterization/method_int.tif'
tif2 <- 'D:/data/data_projects/VRI_Rasterization/method_float.tif'
r1 <- terra::rast(tif1)
r2 <- terra::rast(tif2)
ext1 <- terra::ext(r1)
ext2 <- terra::ext(r2)
ext1
ext2
identical(ext1,ext2)
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- as.data.frame(terra::freq(c1))
f1 <- f1[,2:3]
f1
v1 <- typeof(terra::values(r1))
v2 <- typeof(terra::values(r2))
v1
v2
v1 <- as.integer(terra::values(r1))
v2 <- as.integer(terra::values(r2))
typeof(v1)
typeof(v2)
head(v1)
x1 <- v1-v2
head(x1)
x1
tail(x1)
class(v1)
identical(v1,v2)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
identical(v1,v2)
v1 <- round(as.numeric(terra::values(r1)),1)
v2 <- round(as.numeric(terra::values(r2)),1)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
identical(v1,v2)
z <- (v1 == v2)
z
z <- as.data.frame((v1 == v2) )
head(z)
z[z$`(v1 == v2)`=='FALSE',]
z <- as.data.frame((v1 %in% v2) )
nrwo(z)
nrwo(z)
nrow(z)
x <- as.data.frame(z[z$`(v1 == v2)`=='FALSE',])
x
nrow(x)
identical(v1,v2)
head(v1)
head(v2)
tail(v1)
tail(v2)
r1
r2
v1 <- round(as.numeric(terra::values(r1)),1)
v2 <- round(as.numeric(terra::values(r2)),1)
v1 <- round(as.numeric(terra::values(r1)),0)
v2 <- round(as.numeric(terra::values(r2)),0)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
z <- as.data.frame(v1 == v2)
head(z)
names(z) <- diff
names(z) <- 'diff'
count(z,diff)
tidyverse::count(z,diff)
library(tidyversse)
library(tidyverse)
count(z,diff)
v1 <- round(as.numeric(terra::values(r1)),1)
v2 <- round(as.numeric(terra::values(r2)),1)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
z <- as.data.frame(v1 == v2)
names(z) <- 'diff'
count(z,diff)
z <- as.data.frame(v1- v2)
head(z)
names(z) <- 'diff'
count(z,diff)
z <- as.data.frame(abs(v1- v2))
names(z) <- 'diff'
count(z,diff)
library(sf)
library(terra)
library(RPostgreSQL)
library(sf)
library(terra)
library(RPostgreSQL)
library(raster)
library(kableExtra)
# raster files
tif1 <- 'D:/data/data_projects/VRI_Rasterization/method_int.tif'
tif2 <- 'D:/data/data_projects/VRI_Rasterization/method_float.tif'
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(tif1)
r2 <- terra::rast(tif2)
ext1 <- terra::ext(r1)
ext2 <- terra::ext(r2)
ext1
ext2
# Do a diff
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- as.data.frame(terra::freq(c1))
f1 <- f1[,2:3]
kable(f1,format="html",caption = 'compare int to float') %>%
kable_styling(bootstrap_options = c("striped"),full_width=F,font_size=13,position = 'left')
n <- f1$count[f1$value==1]
n
v1 <- typeof(terra::values(r1))
v2 <- typeof(terra::values(r2))
v1
v2
v1 <- round(as.numeric(terra::values(r1)),1)
v2 <- round(as.numeric(terra::values(r2)),1)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
v3 <- cbind(v1,v2)
head(v3)
v3$diff <- abs(v3$v1 - v3$v2)
class(v3)
v3 <- as.data.frame(v3)
head(v3)
v3$diff <- abs(v3$v1 - v3$v2)
count(v3,diff)
library(tidyverse)
count(v3,diff)
v3[v4$diff != 0,]
v3[v3$diff != 0,]
v1 <- terra::values(r1)
v2 <- terra::values(r2)
v1[2342540,]
v2[2342540,]
s <- v1[v1 == 17676091 ]
s
class(v1)
v1 <- as.data.frame(v1)
head(v1)
s <- v1 %>% subset(method_int == 17676091 )
s
nrow(s)
src <- 'D:/data/data_projects/AR2022/vri/VEG_COMP_LYR_R1_POLY_2021.gdb'
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
lst <- (dest1,dest2)
lst <- List(dest1,dest2)
lst <- list(dest1,dest2)
raster_stack <- stack(lst)
s <- subset(raster_stack, 2497499)
s <- subset(raster_stack, 2497498:2497499)
class(raster_stack)
raster_stack[2497499]
v2 <- terra::values(r2)
v2[2497499]
library(sf)
library(terra)
library(RPostgreSQL)
library(raster)
# read gdb file
src <- 'D:/data/data_projects/AR2022/vri/VEG_COMP_LYR_R1_POLY_2021.gdb'
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
gdal_utils("rasterize",src,dest1,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW'),
'-overwrite')
gdal_utils("rasterize",src,dest2,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'Float32',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW'),
'-overwrite')
library(kableExtra)
# raster files
tif1 <- 'D:/data/data_projects/VRI_Rasterization/method_int.tif'
tif2 <- 'D:/data/data_projects/VRI_Rasterization/method_float.tif'
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(tif1)
r2 <- terra::rast(tif2)
ext1 <- terra::ext(r1)
ext2 <- terra::ext(r2)
ext1
ext2
# Do a diff
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- as.data.frame(terra::freq(c1))
f1 <- f1[,2:3]
kable(f1,format="html",caption = 'compare int to float') %>%
kable_styling(bootstrap_options = c("striped"),full_width=F,font_size=13,position = 'left')
n <- f1$count[f1$value==1]
library(tidyverse)
# check that data types match
v1 <- typeof(terra::values(r1))
v2 <- typeof(terra::values(r2))
v1
v2
v1 <- terra::values(r1)
v2 <- terra::values(r2)
v1r <- round(as.numeric(terra::values(r1)),1)
v2r <- round(as.numeric(terra::values(r2)),1)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
v3 <- cbind(v1,v2)
v3 <- as.data.frame(v3)
v3$diff <- abs(v3$v1 - v3$v2)
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
library(sf)
library(terra)
library(RPostgreSQL)
library(raster)
raster_stack <- stack(list(dest1,dest2))
raster_stack[2497499]
con <- dbConnect('PostgreSQL',dbname='msyt')
fid <- dbGetQuery(con,'select feature_id from msyt_2022.veg_comp')
head(fid)
stack_values <- as.data.frame(values(raster_stack))
r1 <- stack_values %>% select(method_int) %>% subset(!method_int %in% fid$feature_id)
head(stack_values)
r1 <- stack_values %>% select(method_int)
library(tidyverse)
r1 <- stack_values %>% select(method_int) %>% subset(!method_int %in% fid$feature_id)
head(r1)
count(r1,method_int)
r2 <- stack_values %>% select(method_float) %>% subset(!method_float %in% fid$feature_id)
count(r2,method_float)
r2 <- stack_values %>% select(method_float) %>% subset(!method_float %in% fid$feature_id) %>% subset(!is.na(method_float))
nrow(r2)
r2 <- unique(r2)
nrow(r2)
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
library(sf)
library(terra)
library(RPostgreSQL)
library(raster)
library(tidyverse)
# read gdb file
src <- 'D:/data/data_projects/AR2022/vri/VEG_COMP_LYR_R1_POLY_2021.gdb'
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
gdal_utils("rasterize",src,dest1,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'UInt32',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW'),
'-overwrite')
gdal_utils("rasterize",src,dest2,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'Float32',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW'),
'-overwrite')
library(sf)
library(terra)
library(RPostgreSQL)
library(raster)
library(tidyverse)
# read gdb file
src <- 'D:/data/data_projects/AR2022/vri/VEG_COMP_LYR_R1_POLY_2021.gdb'
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
gdal_utils("rasterize",src,dest2,options =
c('-tr','100',' 100',
'-te','159587.5 ','173787.5 ','1881187.5 ','1748187.5',
'-ot', 'Float32',
'-l', 'VEG_COMP_LYR_R1_POLY',
'-a', 'FEATURE_ID' ,
'-a_srs','EPSG:3005',
'-a_nodata', '0',
'-co','COMPRESS=LZW'),
'-overwrite')
library(kableExtra)
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(dest1)
r2 <- terra::rast(dest2)
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- as.data.frame(terra::freq(c1))
f1 <- f1[,2:3]
f1
n <- f1$count[f1$value==1]
n
v1 <- terra::values(r1)
v2 <- terra::values(r2)
v1[is.na(v1)] <- 0
v2[is.na(v2)] <- 0
v3 <- cbind(v1,v2)
v3 <- as.data.frame(v3)
v3$diff <- abs(v3$v1 - v3$v2)
head(v3)
head(v1)
v3$diff <- abs(v3$method_int - v3$method_float)
v3$diff[v3$diff >0] <- 1
count(v3,diff)
f1 <- count(v3,diff)
f1
n <- f1$n[f1$diff==1]
n
raster_stack <- stack(list(dest1,dest2))
raster_stack[2497499]
con <- dbConnect('PostgreSQL',dbname='msyt')
fid <- dbGetQuery(con,'select feature_id from msyt_2022.veg_comp')
stack_values <- as.data.frame(values(raster_stack))
r1 <- stack_values %>% select(method_int) %>% subset(!method_int %in% fid$feature_id)
r2 <- stack_values %>% select(method_float) %>% subset(!method_float %in% fid$feature_id) %>% subset(!is.na(method_float))
n1 <- nrow(r1)
n1
r1 <- stack_values %>% select(method_int) %>% subset(!method_int %in% fid$feature_id) %>% subset(!is.na(method_int))
r1 <- unique(r1)
r1
n1 <- nrow(r1)
n1
r2 <- unique(r2)
n2 <- nrow(r2)
n2
dest1
library(sf)
library(terra)
library(RPostgreSQL)
library(raster)
library(tidyverse)
dest1 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_int.tif')
dest2 <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method_float.tif')
raster_stack <- stack(list(dest1,dest2))
rs <- raster_stack[2497499]
r2
rs
class(r2)
class(rs)
rs <- as.data.frame(raster_stack[2497499])
rs
library(kableExtra)
# raster files
tif_method1 <- 'D:/data/data_projects/VRI_Rasterization/method1.tif'
tif_method2 <- 'D:/data/data_projects/VRI_Rasterization/method2.tif'
tif_method3 <- 'D:/data/data_projects/VRI_Rasterization/method3.tif'
tif_method4 <- 'D:/data/data_projects/VRI_Rasterization/method4.tif'
tif_method5 <- 'D:/data/data_projects/VRI_Rasterization/fasterize2.tif'
vri_official <- 'D:/data/data_projects/AR2022/base/veg_comp_lyr_r1_poly_internal_2021.tif'
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(tif_method1)
r2 <- terra::rast(tif_method2)
c1 <- r1 - r2
c1[c1 != 0] <- 1
f1 <- as.data.frame(terra::freq(c1))
f1 <- f1[,2:3]
f1
# compare 1 to 3
r3 <- terra::rast(tif_method3)
c1 <- r1 - r3
c1[c1 != 0] <- 1
# differences
# 0 = no difference
# 1 = difference of 1
# 2 = difference greater than 1
f2 <- as.data.frame(terra::freq(c1))
f2 <- f2[,2:3]
f2
# raster files
tif_method1 <- 'D:/data/data_projects/VRI_Rasterization/method1.tif'
tif_method2 <- 'D:/data/data_projects/VRI_Rasterization/method2.tif'
tif_method3 <- 'D:/data/data_projects/VRI_Rasterization/method3.tif'
tif_method4 <- 'D:/data/data_projects/VRI_Rasterization/method4.tif'
tif_method5 <- 'D:/data/data_projects/VRI_Rasterization/fasterize2.tif'
vri_official <- 'D:/data/data_projects/AR2022/base/veg_comp_lyr_r1_poly_internal_2021.tif'
# read each raster set and compare
# if the diff is not zero, set it to 1
# this will show where pixel values are different
r1 <- terra::rast(tif_method1)
r5 <- terra::rast(vri_official)
# force projection
terra::crs(r5) <- 'epsg:3005'
# use absolutes
c1 <- abs(r1 - r5)
# where the difference is 1 assign 2
c1[c1 != 0] <- 1
f4 <- as.data.frame(terra::freq(c1))
f4 <- f4[,2:3]
f4
lst <- list(r1,r2,r3,r4,r5)
lst(r1r5)
lst <- list(r1,r5)
raster_brick <-terra::rast(lst)
# write brick to a tiff
tif_brick <- 'D:/data/data_projects/VRI_Rasterization/tif_brick.tif'
terra::writeRaster(raster_brick, tif_brick, datatype='INT4U', overwrite=TRUE)
diff_tif <- 'D:/data/data_projects/VRI_Rasterization/tif_diff.tif'
terra::writeRaster(c1, diff_tif, datatype='INT4U', overwrite=TRUE)
dest <- paste0(substr(getwd(),1,1),':/data/data_projects/VRI_Rasterization/method1.tif')
r1 <- terra::rast(dest)
r1[is.na(r1)]  <- 0
terra::writeRaster(r1, dest, datatype='INT4U', overwrite=TRUE)
